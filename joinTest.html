<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="u" %>
    
    <section class="junsec">
       <div>
           <div class="container">
               <div class="row">
                   <form action="join" id="join" method="post">
                   <div class="junjoin">
                       <div class="col-sm-12 col-xs-12 junjoin-wrap">
                           <div class="col-sm-12 col-xs-12 junid-form">
                               아이디<br/>
                               <input type="text" class="form-control junid" id="userId" name="userId" placeholder="아이디는 4~8글자" style="display:inline-block">
                               <button type="button" class="junidCheck" id="idCheck">중복</button>
                            </div>
                            <div class="col-sm-12 col-xs-12 junpw-form">
                                비밀번호<br/>
                                <input type="password" class="form-control junpw" name="userPw" placeholder="비밀번호는 4~12글자">
                            </div>
                            <div class="col-sm-12 col-xs-12 junpwCheck-form">
                                비밀번호 확인<br/>
                                <input type="password" class="form-control junpwCheck">
                                <span class="junpwMsg"></span>
                            </div>
                            <div class="col-sm-12 col-xs-12 junname-form">
                                이름<br/>
                                <input type="text" class="form-control junname" name="userName">
                                </div>
                            <div class="col-sm-12 col-xs-12 junphone-form">
                                핸드폰번호<br/>
                                <input type="text" class="form-control junphone" name="userPhone">
                            </div>
                            <div class="col-sm-12 col-xs-12 junemail-form">
                                이메일<br/>
                                <input type="text" class="form-control junemail" name="userEmail">
                            </div>
                            <div class="col-sm-12 col-xs-12 junbirth-form">
  			   생년월일<br/>

                                <input type="text" class="form-control junbirth" name="userBirth" id="userCal" style="display:inline-block" readonly>


                            </div>
                            <div class="col-sm-12 col-xs-12 junaddnum-form">
                                우편번호
                            	<button type="button" class="post" onclick="exePost()">주소검색</button>
                                <input type="text" class="form-control junaddnum" name="userZipCode" id="sample6_postcode">
                            </div>
                            <div class="col-sm-12 col-xs-12 junadd-form">
                                주소<br/>
                                <input type="text" class="form-control junadd" name="userAddr" id="sample4_roadAddress"><br/>
                                상세주소<br/>
                                <input type="text" class="form-control junadd2" name="userAddrDetail" id="sample6_detailAddress">

                                <button type="button" class="junjoinbtn">회원가입</button>
                            </div>
                        </div>
                    </div>
                   </form>
                </div>
            </div>
        </div>
        </section>
        
        <!-- 달력 기능 -->
        <script>
        	$("#userCal").datepicker({
        		showOn : "button",
        		buttonText : "달력",
        		changeMonth : true,
        		changeYear : true,
        		yearRange : "1920:2001",
        	    prevText : "이전 달",
        	    nextText : "다음 달",
        	    monthNames : ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
        	    dayNamesMin : ['일', '월', '화', '수', '목', '금', '토'],
        	    showMonthAfterYear : true,
        	    showAnim : "slideDown",
        	    showButtonPanel: true,
        	    dateFormat : "yymmdd"

        	}).next(".ui-datepicker-trigger").css("margin-top", "2px")
        									 .css("width", "48px")
        									 .css("height", "45%")
        									 .css("color", "#5f1e09f1")
        									 .css("background-color", "rgb(240,220,220)")
        									 .css("position", "absolute")
        									 .css("border-color", "rgb(240,220,220)")
        									 .css("margin-left", "-50px")
        </script>
        
        <script>
        //아이디 중복체크
       	$("#idCheck").click(function() {
			
       		var userId = $("#userId").val();
       		
       		if( userId == '' || userId.length < 4 || userId.length > 8) {
       			$("#userId").focus();
       			alert("아이디는 4~8글자입니다.");
       			return;
       		}
       		
       		$.ajax({
       			type: "post",
       			url : "idCheck",
       			dataType : "json",
       			contentType: "application/json",
       			data : JSON.stringify({"userId" : userId}),
       			success : function(data) {
					
       				if(data == 0) {
       					$("#userId").attr("readonly", true);
       					alert("사용가능한 아이디입니다.");
       				} else {
       					alert("중복된 아이디입니다.");
       				}
       				
				},
				error : function(request,status, error) {
					alert("에러발생");
				}
       		})
       		
		});
        
        //검증
        $(".junjoinbtn").click(function() {
        	
        	var userId = $("#userId").val();
        	
        	if( $("#userId").attr("readonly") != 'readonly') {
        		alert("아이디 중복체크가 필요합니다.");
        		$("#userId").focus();
        		return;
        	} else if( $(".junpw").val() == '') {
        		alert("비밀번호 입력은 필수입니다.");
        		$("#junpw").focus();
        		return;
        	} else if( $(".junpw").val() != $(".junpwCheck").val() ) {
        		alert("비밀번호가 같지 않습니다.");
        		$(".junpw").focus();
        		return;
        	} else if( $(".junname").val() == '') {
        		alert("이름은 필수입니다");
        		$("#junname").focus();
        		return;
        	} else if( $(".junpw").val().length < 4 || $(".junpw").val().length > 12 ) {
        		alert("비밀번호는 4~12글자 입니다.");
        		$("#junpw").focus();
        		return;
        	} else {
	       		$("#join").submit();
	       		alert(userId + "님의 회원가입을 축하합니다.")
        	}
			
		});
        
        </script>
        <!-- 주소 검색창 -->
        <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
		<script>
		
		   	function exePost() {
		   	    daum.postcode.load(function() {
		   	        new daum.Postcode({
		   	            oncomplete: function(data) {
		   	                
		   	            var roadAddr = data.roadAddress; // 도로명 주소 변수
		   	            var extraRoadAddr = ''; // 참고 항목 변수
		
		   	            // 법정동명이 있을 경우 추가한다. (법정리는 제외)
		   	            // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
		   	            if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
		   	                extraRoadAddr += data.bname;
		   	            }
		   	            // 건물명이 있고, 공동주택일 경우 추가한다.
		   	            if(data.buildingName !== '' && data.apartment === 'Y'){
		   	               extraRoadAddr += (extraRoadAddr !== '' ? ', ' + data.buildingName : data.buildingName);
		   	            }
		   	            // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
		   	            if(extraRoadAddr !== ''){
		   	                extraRoadAddr = ' (' + extraRoadAddr + ')';
		   	            }
		
		   	            // 우편번호와 주소 정보를 해당 필드에 넣는다.
		   	            document.getElementById('sample6_postcode').value = data.zonecode;
		   	            document.getElementById("sample4_roadAddress").value = roadAddr;
		   	         	document.getElementById("sample6_detailAddress").focus();
		
		   	            var guideTextBox = document.getElementById("guide");
		   	            // 사용자가 '선택 안함'을 클릭한 경우, 예상 주소라는 표시를 해준다.
		   	            if(data.autoRoadAddress) {
		   	                var expRoadAddr = data.autoRoadAddress + extraRoadAddr;
		   	                guideTextBox.innerHTML = '(예상 도로명 주소 : ' + expRoadAddr + ')';
		   	                guideTextBox.style.display = 'block';
		
		   	            }
			
		
		   	            }
		   	        }).open();
		   	    });
		   	}
		</script>